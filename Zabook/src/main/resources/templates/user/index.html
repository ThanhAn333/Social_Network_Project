<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon">
	<title>facebook.com</title>
	<!-- style css link -->
	<link rel="stylesheet" href="/css/style.css">
	<!-- fontawesome css link -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
		integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
		crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link href="https://cdn.jsdelivr.net/npm/@feathericons/feather@4.28.0/dist/feather.min.css" rel="stylesheet">
	<style>
		.story-modal {
			display: none;
			/* Ẩn ban đầu */
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, 0.8);
			/* Nền tối mờ */
			z-index: 1000;
			display: flex;
			justify-content: center;
			align-items: center;
		}

		.story-modal .story-content {
			position: relative;
			width: 40%;
			max-width: 600px;
			height: 80%;
			background: #fff;
			border-radius: 10px;
			overflow: hidden;
			text-align: center;
		}

		.story-modal img,
		.story-modal video {
			width: 100%;
			height: 100%;
			object-fit: cover;
		}

		.story-modal p {
			position: absolute;
			bottom: 10px;
			left: 50%;
			transform: translateX(-50%);
			color: #fff;
			text-shadow: 0 1px 8px black;
			font-size: 18px;
		}

		.close-btn {
			position: absolute;
			top: 20px;
			right: 20px;
			font-size: 30px;
			color: #fff;
			cursor: pointer;
			z-index: 1001;
		}
	</style>
</head>

<body>

	<!-- header section start -->


	<header>
		<div class="header-container">
			<div class="header-wrapper">
				<div class="logoBox">
					<img src="/images/th.png" alt="logo">
				</div>
				<div class="searchBox">
					<input type="search">
					<i class="fas fa-search"></i>
				</div>
				<!-- Navigation Icons -->
				<div class="iconBox1">
					<a href="/user/"><i class="fa-solid fa-house"></i></a>
					<a href="/user/groups"><i class="fa-solid fa-user-group"></i></a>
					<a href="/user/video"><i class="fa-solid fa-video"></i></a>
					<a href="/user/games"><i class="fa-solid fa-gamepad"></i></a>
				</div>

				<!-- User Options -->
				<div class="iconBox2">
					<a href="#"><i class="fa-solid fa-circle-plus"></i></a>
					<a href="#"><i class="fa-brands fa-facebook-messenger"></i></a>
					<a href="#"><i class="fa-solid fa-bell"></i></a>
					<label><img src="/images/user.jpg" alt="user"></label>
					<a href="#"><i class="fa-solid fa-caret-down"></i></a>
				</div>
			</div>
		</div>
	</header>


	<!-- header section end -->
	<!-- home section start -->


	<div class="home">
		<div class="container">
			<div class="home-weapper">

				<!-- home left start here -->
				<div class="home-left">

					<div class="profile">
						<a href="/user/profile">
							<img th:src="${currentuser.avatar != null} ? ${currentuser.avatar} : '/images/icon/person.svg'"
								alt="Profile Picture">

							<h3 th:text="${currentuser.lastName}"></h3>
						</a>

					</div>

					<div class="pages">
						<h4 class="mini-headign">Pages</h4>
						<label>
							<img src="/images/messenger.png" alt="messenger">
							<span>messenger</span>
						</label>
						<label>
							<img src="/images/instagram.png" alt="instagram">
							<span>instagram</span>
						</label>
						<button class="see-more-btn">See more <i class="fa-solid fa-angle-down"></i></button>
					</div>

					<div class="group">
						<h4 class="mini-headign">Group</h4>
						<label>
							<img src="/images/gg.png" alt="group01">
							<span>Graphic design</span>
						</label>

						<label>
							<img src="/images/gg2.png" alt="group02">
							<span>website design</span>
						</label>

						<label>
							<img src="/images/gg3.png" alt="group03">
							<span>ZED.zahidul</span>
						</label>

						<button class="see-more-btn">See more <i class="fa-solid fa-angle-down"></i></button>
					</div>

					<div class="games">
						<h4 class="mini-headign">Games</h4>
						<label>
							<img src="/images/game.png" alt="game01">
							<span>Facebook games</span>
						</label>
						<label>
							<img src="images/game2.png" alt="game02">
							<span>Free Play Games</span>
						</label>
						<button class="see-more-btn">See more <i class="fa-solid fa-angle-down"></i></button>
					</div>

					<div class="explore">
						<h4 class="mini-headign">Explore</h4>

						<a href="#"><i class="fa-solid fa-user-group"></i> Group</a>
						<a href="#"><i class="fa-solid fa-star"></i></i> Favorites</a>
						<a href="#"><i class="fa-solid fa-bookmark"></i></i> Saves</a>
						<a href="#"><i class="fa-solid fa-clock"></i> Events</a>
						<a href="#"><i class="fa-solid fa-flag"></i> Pages</a>

						<div><label class="darkTheme"> <span></span></label> Apply Dark Theme</div>

						<button class="see-more-btn">See more <i class="fa-solid fa-angle-down"></i></button>
					</div>

				</div><!-- home left end here -->

				<!-- home center start here -->

				<div class="home-center">
					<div class="home-center-wrapper">
						<div class="stories">
							<h3 class="mini-headign">Stories</h3>
							<div class="stories-wrapper">

								<div class="single-stories" onclick="showPopup()">
									<label>
										<img src="/images/user.jpg" alt="user">
									</label>
									<div>
										<img src="/images/user.jpg" alt="user">
										<i class="fa-solid fa-circle-plus"></i>
										<b>Create Stories</b>
									</div>
								</div>
								<!-- Ảnh đại diện nhỏ -->
								<div class="single-stories" th:each="story, i : ${stories}"
									th:onclick="|openStory(${i.index})|">
									<label>
										<img th:src="@{${story.user != null ? story.getUser().getImage() : '/images/default-user.jpg'}}"
											alt="user-avatar">
									</label>
									<div>
										<img th:if="${story.image != null}" th:src="@{${story.image}}"
											alt="story-image">
										<p th:if="${story.textContent != null}" th:text="${story.textContent}"></p>
										<b
											th:text="${story.user != null ? story.getUser().getLastName() + ' ' + story.getUser().getFirstName() : 'Unknown User'}">User
											Name</b>
									</div>
								</div>
							</div>
						</div>


						<div class="createPost">
							<form action="/user/post/create" method="post" enctype="multipart/form-data">


								<h3 class="mini-headign">Create Post</h3>
								<div class="post-text">
									<img src="/images/user.jpg" alt="user">
									<input type="text-area" placeholder="What's on your mind, zahidul" name="content">
								</div>

								<!-- Previews -->
								<div id="previewSection" style="margin-top: 10px;">

									<div id="galleryPreview" style="display: flex; gap: 10px; flex-wrap: wrap;"></div>


									<div id="videoPreview" style="display: flex; gap: 10px; flex-wrap: wrap;"></div>
								</div>


								<div class="post-icon">

									<!-- Gallery Upload -->
									<label for="galleryInput" class="upload-label gallery">
										<i class="upload-icon gallery-icon fa-solid fa-camera"></i> Gallery
									</label>

									<input type="file" id="galleryInput" name="images" accept="image/*" multiple
										style="display: none;"
										onchange="previewFiles('galleryPreview', 'galleryInput', 'image')">

									<!-- Video Upload -->
									<label for="videoInput" class="upload-label video">
										<i class="upload-icon video-icon fa-solid fa-video"></i> Video
									</label>
									<input type="file" id="videoInput" name="videos" accept="video/*" multiple
										style="display: none;"
										onchange="previewFiles('videoPreview', 'videoInput', 'video')">



									<button type="submit" class="upload-label button"> Đăng</button>
								</div>

							</form>
						</div>

						<div th:each="post : ${posts}">

							<div class="fb-post1">
								<div class="fb-post1-container" data-post-id="${post.id}">
									<div class="fb-post1-header">
										<!-- <ul>
											<li class="active">popular</li>

											<li>recent</li>
											<li>most view</li>
										</ul> -->
									</div>
									<div class="fb-p1-main">
										<div class="post-title">
											<img th:src="${post.user.avatar}" alt="user picture">
											<ul>
												<li>
													<h3 th:text="${post.getUser() != null ? post.getUser().getFirstName() + ' ' + post.getUser().getLastName() : 'Unknown User'}">
    <span th:if="${post.isShared}" style="display: inline;"> - Chia sẻ bài viết</span>
</h3>

													
												</li>
												<li><span th:text="${post.timeAgo}"></span></li>
											</ul>

										
											<p th:if="${post.contentShare == null || post.contentShare.isEmpty()}" th:text="${post.content}"></p>
<p th:if="${post.contentShare != null && !post.contentShare.isEmpty()}">
    <span th:text="${post.contentShare}"></span>
   
    <span th:text="${post.content}"></span>
</p>

												
										
											


										</div>

										<div class="post-images">
											<div class="post-images1">
												<ul>
													<!-- Duyệt qua danh sách images và hiển thị -->
													<li th:if="${post.image != null}"
														th:each="image : ${post.getImage()}">
														<div class="image-item">
															<!-- Kiểm tra nếu linkImage khác null -->

															<img th:if="${image != null and image.linkImage != null}"
																th:src="@{'/uploads/images/' + ${image.linkImage}}" />
														</div>
													</li>


													<li th:each="video : ${post.video}">
														<div class="video-item">
															<!-- Kiểm tra nếu linkVideo khác null -->
															<video th:if="${video.linkVideo != null}"
																th:src="@{'/uploads/videos/' + ${video.linkVideo}}"
																controls width="100%" style="border-radius: 10px">
																Trình duyệt của bạn không hỗ trợ thẻ video.
															</video>

														</div>
													</li>
												</ul>
											</div>
											<div class="post-images2">


											</div>

										</div>

										<div class="like-comment">
											<ul>
												<li>
													<img src="/images/love.png" alt="love">
													<img src="/images/like.png" alt="like">
													<!-- Số lượt like, khi bấm vào sẽ mở cửa sổ modal -->
													<span th:text="${post.likeCount}"
														id="likeCountSpan_${post.id}"></span>



												</li>
												<li> <span th:text="${post.getCommentCount()}"></span>bình luận</li>
												<li> <span th:text="${post.shareCount}"></span>chia sẻ</li>
											</ul>
											<!--listUser-->

											<!--like comment-->

											<div class="post-actions">




												<button class="btn-like" th:data-postId="${post.id}">


													<i class="fas fa-thumbs-up"></i> Thích
													<div class="emoji-icons">
														<i class="fas fa-thumbs-up like"
															onclick="selectReaction(event, this, 'Thích')"></i>
														<i class="fas fa-heart love"
															onclick="selectReaction(event, this, 'Yêu thích')"></i>
														<i class="fas fa-laugh-squint haha"
															onclick="selectReaction(event, this, 'Haha')"></i>
														<i class="fas fa-surprise wow"
															onclick="selectReaction(event, this, 'Wow')"></i>
														<i class="fas fa-sad-tear sad"
															onclick="selectReaction(event, this, 'Buồn')"></i>
														<i class="fas fa-angry angry"
															onclick="selectReaction(event, this, 'Phẫn nộ')"></i>
													</div>
												</button>

												<button class="btn-comment" onclick="toggleCommentForm(this)"><i
														class="fas fa-comment-alt"></i> Bình
													luận</button>


												<button class="btn-share" onclick="toggleSharePopup(this)"
													th:data-user="${post.user.firstName+' '+post.user.lastName}"
													th:data-postid="${post.id}">
													<i class="fa-solid fa-share-from-square"></i> Chia sẻ
												</button>



												<!-- Form chia sẻ dạng Popup -->
												<div class="share-popup" style="display: none;">
													<div class="popup-content">
														<span class="popup-close"
															onclick="toggleSharePopup(this)">&times;</span>
														<h3>Chia sẻ bài viết</h3>

														<div class="share-header">
															<img th:src="${user.avatar}" alt="User Avatar"
																class="user-avatar">
															<h4 th:text="${user.firstName+' '+user.lastName}">
															</h4>


														</div>
														<div class="share-textarea">
															<textarea placeholder="Bạn nghĩ gì về bài viết này?"
																name="content" rows="4"></textarea>
														</div>
														<div class="share-actions">
															<form action="/user/post/share" method="post">
																<p id="share-postid" name="postId" style="display: none;"></p>
																<input type="hidden" name="postId"
																	id="share-postid-input">
																<button class="btn-send">
																	<i class="fas fa-arrow-right"></i> Chia sẻ
																</button>
															</form>

															<button class="btn-cancel"
																onclick="toggleSharePopup(this)">Hủy</button>
														</div>
													</div>
												</div>

											</div>
											<!-- Form bình luận ẩn mặc định -->
											<div class="comment-form-container" style="display: none;">
												<div>
													<li th:if="${#lists.isEmpty(post.comment)}">
														<label>Chưa có bình luận nào!</label>
													</li>
													<li th:if="${!#lists.isEmpty(post.comment)}"
														th:each="comment : ${post.comment}">
														<div class="comment-box">
															<img class="avatar"
																th:if="${comment.userComment.avatar}!=null"
																th:src="${comment.userComment.avatar}" alt="Avatar">
															<div class="comment-content">
																<p><strong
																		th:text="${comment.userComment.firstName + ' ' + comment.userComment.lastName}"></strong>
																</p>
																<p th:text="${comment.content}">Miền cực lạc đâu</p>
																<div class="comment-actions">
																	<span id="commentTime"
																		th:text="${comment.createTime}"></span>
																	<span id="elapsedTime"></span>

																	<button class="buttoncomment">Thích</button>
																</div>
															</div>
														</div>
													</li>

												</div>


												<div class="comment-bar">
													<form action="/user/comments/add" method="post" id="comment-form">
														<input type="hidden" id="postId" name="postId"
															th:value="${post.id}">
														<input type="text" id="contentInput" name="content"
															placeholder="Viết bình luận...">
														<button id="isendCommentBtn" type="submit">
															<img class="img-send-comment" width="24" height="24"
																src="https://img.icons8.com/material-rounded/24/sent.png"
																alt="sent" />
														</button>
													</form>

												</div>

											</div>

										</div>
									</div>
								</div>
							</div>
						</div>
					</div> <!-- home center wrapper end -->
				</div> <!-- home center end -->

				<div class="home-right">
					<div class="home-right-wrapper">

						<div class="event-friend">
							<div class="event">
								<h3 class="heading">Upcoming Events <span>see all</span></h3>
								<img src="/images/eve.jpg" alt="event-img">
								<div class="event-date">
									<h3>21 <b>july</b></h3>
									<h4>United state of America <span>New York City</span></h4>
								</div>
								<button><i class="fa-regular fa-star"></i> interested</button>
							</div>

							<hr>

							<div class="friend">
								<h3 class="heading">Friend Requests <span>see all</span></h3>
								<ul>
									<li><img src="/images/user4.jpg" alt="user"></li>
									<li>
										<b>armanul islam</b>
										<p>Lorem ipsum dolor sit amet.</p>
										<button>confirm</button><button class="friend-remove">remove</button>
									</li>
								</ul>
							</div>

						</div>

						<div class="create-page">
							<ul>
								<li>
									<i class="fa-solid fa-circle-plus"></i>
									<h4>Create Page & Groups</h4>
									<i class="fa-solid fa-magnifying-glass"></i>
								</li>
								<li>
									<img src="/images/group.jpg" alt="groups">
								</li>
								<li>
									<b>simple group or page name <span>200k Members</span></b>
									<button>Join Group</button>
								</li>
							</ul>
						</div>

						<div class="messenger">
							<div class="messenger-search">
								<i class="fa-solid fa-user-group"></i>
								<h4>Messenger</h4>
								<input type="search" placeholder="Search">
								<i class="fa-solid fa-magnifying-glass"></i>
							</div>
							<ul>
								<li>
									<img src="/images/us2.png" alt="user">
									<b>Zunayed Hossain <span>Online</span></b>
									<i class="fa-brands fa-facebook-messenger"></i>
								</li>

								<li>
									<img src="/images/us3.png" alt="user">
									<b>Armanul Islam <span>Offline</span></b>
									<i class="fa-brands fa-facebook-messenger"></i>
								</li>

								<li>
									<img src="/images/us4.png" alt="user">
									<b>Mohammad Amir <span>Online</span></b>
									<i class="fa-brands fa-facebook-messenger"></i>
								</li>
							</ul>
						</div>

					</div><!-- home right wrapper end -->
				</div><!-- home right end -->






			</div>
		</div>
	</div>




	<!-- home section end -->
	<div id="popupOverlay" class="popup-overlay">
		<div class="popup-form">
			<span class="close-btn" onclick="hidePopup()">&times;</span>
			<h3>Tạo Story mới</h3>

			<!-- Lựa chọn loại Story -->
			<div>
				<label>
					<input type="radio" name="storyType" value="text" onchange="toggleStoryType()" checked> Đăng Nội
					dung
				</label>
				<label>
					<input type="radio" name="storyType" value="media" onchange="toggleStoryType()"> Đăng Hình ảnh/Video
				</label>
			</div>

			<!-- Form tạo Story -->
			<form th:action="@{/user/story/createStory}" method="post" enctype="multipart/form-data">
				<!-- Phần nhập nội dung văn bản -->
				<div id="textStory" style="margin-top: 10px;">
					<label for="textContent">Nội dung Story:</label>
					<textarea id="textContent" name="textContent" rows="4" placeholder="Nhập nội dung..."></textarea>
				</div>

				<!-- Phần tải lên hình ảnh hoặc video -->
				<div id="mediaStory" style="display: none; margin-top: 10px;">
					<label for="mediaFile">Hình ảnh hoặc Video:</label>
					<input type="file" id="mediaFile" name="file" accept="image/*,video/*"
						onchange="previewMedia(event)">

					<!-- Khu vực xem trước -->
					<div id="previewContainer" style="margin-top: 10px;">
						<img id="imagePreview" src="#" alt="Image Preview" style="max-width: 100%; display: none;">
						<video id="videoPreview" controls style="max-width: 100%; display: none;"></video>
					</div>
				</div>

				<br><br>
				<button type="submit">Đăng Story</button>
			</form>
		</div>
	</div>
	<div>
		<div id="storyModal" class="story-modal">
			<span class="close-btn" onclick="closeStory()">×</span>
			<div class="story-content">
				<!-- Thông tin người dùng: Avatar và thời gian -->
				<div class="story-header">
					<img id="modalAvatar" class="story-avatar" src="" alt="user-avatar">
					<div class="story-info">
						<b id="modalUserName">User Name</b>
						<span id="modalTime">Time</span>
					</div>
				</div>
				<img id="modalImage" src="" alt="story-image">
				<video id="modalVideo" autoplay muted loop style="display:none;"></video>
				<p id="modalText"></p>
			</div>

			<!-- Nút chuyển story -->
			<div class="story-nav left" onclick="prevStory()">&#10094;</div>
			<div class="story-nav right" onclick="nextStory()">&#10095;</div>
		</div>

		<!-- JavaScript -->
		<script th:inline="javascript">
			let currentStoryIndex = 0;
			let stories = /*[[${stories}]]*/[];
			stories = stories.map(story => {
				return {
					avatar: story.user != null ? story.user.image : '/images/avatar.jpg',
					userName: story.user != null ? story.user.lastName + ' ' + story.user.firstName : 'Unknown User',
					time: story.timestamp || 'Unknown Time',
					image: story.image || null,
					video: story.video || null,
					textContent: story.textContent || ''
				};
			});

			// Đảm bảo modal được ẩn khi trang được load lại
			document.addEventListener("DOMContentLoaded", function () {
				const modal = document.getElementById('storyModal');
				if (modal) {
					modal.style.display = 'none'; // Ẩn modal khi trang load xong
				}
			});
		</script>
		<script src="/js/index.js"></script>

</body>


</html>